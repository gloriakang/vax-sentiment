define(["jquery","config","templates","libs/jquery-plugins/jquery.cookie","libs/jquery-plugins/jquery.ctr"],function(a,b,c,d,e){var f={recommendationsCallback:function(d){var e=d.recommendations,f=c["rightrail.stories"],g=c.upnext,h=a(".rr-block"),i=null,j=null,k=[];if(e){a.each(e,function(a,b){(""===b.thumbnail||"None"===b.thumbnail)&&(b.thumbnail=!1),""===b.menuline&&(b.menuline=b.hed),"Slate Plus Stories"==b.source?b.slateplus=!0:b.slateplus=!1,0!==b.parsely_rank&&k.push(b),b.position=a+1}),a.each(h,function(b,c){var d=a(c),g=a(c).data("count");g&&g<=e.length?(d.html(f({recommendations:e.slice(0,g)})),e=e.slice(g)):d.html(f({recommendations:e}))}),k=k.sort(function(a,b){return a.parsely_rank-b.parsely_rank});try{i=k[0]}catch(l){i=null}try{j=k[1]}catch(l){j=null}a("#rr-results").track()}b.env.edit||1!=a('link[rel="canonical"]').size()||requirejs(["jquery","outbrain","templates"],function(a,b,c){var d=document.location.pathname.indexOf("articles")>-1?4:3,e=encodeURI(a('link[rel="canonical"]').attr("href")),f=c["rightrail.stories"],g={permalink:e,widgetId:"AR_12"},h=function(b,c){a.each(b.doc,function(b,c){if(!(0>=d)){var e,g={business:!1,rubrics:[],sponsored:!1,outbrain:!0,top_two:!1,parsely_rank:0,partner:!0,pub_date:"",canonical_url:c.orig_url,author:"",url:c.url,blogs:[],menuline:c.content,source:c.source_name,dek:"",articleId:0,large_thumbnail:c.thumbnail.url,sections:[],thumbnail:c.thumbnail.url};e=a(3>d?a(".rr-block").get(1):a(".rr-block").get(2));var h=e.children(),i=h.length,j=Math.floor((i+1)*Math.random());i===j?e.append(f({recommendations:g})):a(h[j]).before(f({recommendations:g})),d-=1}})};b.extern.callRecs(g,h)}),mobileMode()||(null!==i||null!==j?a("#up-next-box").html(g({top1:i,top2:j})):a("#up-next-box").css("border","none"),a("#upnext-results").track())},recommendations:function(c,d,e){var g={url:document.URL,wapo_vis_id:a.cookie("wapo_vis_id")||1,limit:c,days:d,method:e},h=b.myslate.myslate_domain,i=b.myslate.myslate_https,j=(i?"https:":"http:")+h+"recommendations/get_combined_json";a.ajax({type:"GET",url:j,data:g,async:!1,contentType:"application/json",dataType:"jsonp",success:jQuery.proxy(f.recommendationsCallback),error:function(a){console&&console.log&&console.log(a.message)}})},init:function(a,b,c){var d=null!==a&&a>0?a:30,e=null!==b&&b>0?b:14,g=null!==c&&""!==c?c:"trending";f.recommendations(d,e,g)}};return f});