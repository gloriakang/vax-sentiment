define("common/modules/commercial/article-aside-adverts",["fastdom","Promise","common/utils/_","common/utils/$","common/utils/$css","common/utils/config","common/modules/commercial/create-ad-slot"],function(e,n,t,o,i,c,r){function a(a){var m,s,l,u,d=t.defaults(a||{},{columnSelector:".js-secondary-column",adSlotContainerSelector:".js-ad-slot-container"}),f=o(d.columnSelector),g=f.length&&"none"===i(f,"display");return c.switches.standardAdverts&&/Article|LiveBlog/.test(c.page.contentType)&&!g?(m="Article"===c.page.contentType?o(".js-content-main-column"):!1,l=o(".js-components-container",".js-secondary-column"),u=o(d.adSlotContainerSelector),new n(function(n){e.read(function(){s=!m.length||"football"!==c.page.section&&m.dim().height>=1300||"football"===c.page.section&&m.dim().height>=2200?"right-sticky":m.dim().height>=600?"right":"right-small",e.write(function(){"Article"===c.page.contentType&&"advertisement-features"===c.page.sponsorshipType&&l.addClass("u-h"),u.append(r(s,"mpu-banner-ad")),n(u)})})})):!1}return{init:a}}),define("common/modules/commercial/article-body-adverts",["fastdom","Promise","common/utils/_","common/utils/$","common/utils/config","common/utils/detect","common/modules/article/spacefinder","common/modules/commercial/create-ad-slot"],function(e,n,t,o,i,c,r,a){function m(){return{minAbove:c.isBreakpoint({max:"tablet"})?300:700,minBelow:300,selectors:{" > h2":{minAbove:"mobile"===c.getBreakpoint()?20:0,minBelow:250}," > *:not(p):not(h2)":{minAbove:35,minBelow:400}," .ad-slot":{minAbove:500,minBelow:500}}}}function s(){var e=t.cloneDeep(m());return e.minAbove=300,e.selectors[" > h2"].minAbove=20,e}function l(){var e=t.cloneDeep(m());return e.selectors[" .ad-slot"]={minAbove:1300,minBelow:1300},e}function u(){return r.getParaWithSpace(l()).then(function(e){return"undefined"==typeof e?n.resolve(null):(f.push(["inline"+(d.length+1),"inline"]),g(e).then(function(){return u()}))})}var d=[],f=[["inline1","inline"],["inline2","inline"]],g=function(t){if(t){var i=f[d.length],c=o.create(a(i[0],i[1]));return d.push(c),new n(function(n){e.write(function(){c.insertBefore(t),n(null)})})}return n.resolve(null)},p=function(){var e,t,o;return!i.switches.standardAdverts||"Article"!==i.page.contentType||i.page.isLiveBlog?!1:(e=m(),t=s(),i.page.hasInlineMerchandise?(f.unshift(["im","im"]),o=r.getParaWithSpace(t).then(function(e){return g(e)})):o=n.resolve(null),i.switches.viewability&&i.switches.commercialExtraAds?o.then(function(){return r.getParaWithSpace(e).then(function(e){return g(e)}).then(function(){return r.getParaWithSpace(e).then(function(e){return g(e)}).then(function(){return u()})})}):o.then(function(){return r.getParaWithSpace(e).then(function(e){return g(e)}).then(function(){return c.isBreakpoint({max:"tablet"})?r.getParaWithSpace(e).then(function(e){return g(e)}):n.resolve(null)})}))};return{init:p,getRules:m,getLenientRules:s,reset:function(){d=[]}}}),define("common/modules/commercial/front-commercial-components",["bonzo","common/utils/$","common/utils/config","common/modules/commercial/create-ad-slot"],function(e,n,t,o){function i(){if(!t.switches.commercialComponents||!t.page.isFront)return!1;var i,c=n.create('<div class="fc-container"></div>'),r=e(o("merchandising-high","commercial-component-high")),a=n(".fc-container");return a.length>=2?(i=0,a.length>=4&&(i="Network Front"===t.page.contentType?3:2),c.append(r).insertAfter(a[i])):void 0}return{init:i}}),define("common/modules/commercial/slice-adverts",["bonzo","fastdom","qwery","Promise","common/utils/$","common/utils/_","common/utils/config","common/modules/commercial/create-ad-slot","common/modules/user-prefs"],function(e,n,t,o,i,c,r,a,m){var s=["inline1","inline2","inline3"],l=function(l){if(!r.switches.standardAdverts)return!1;for(var u,d,f,g,p=c.defaults(l||{},{containerSelector:".fc-container",sliceSelector:".js-fc-slice-mpu-candidate"}),h=t(p.containerSelector),w=0,v=[],b=1,y=m.get("container-states");w<h.length;)u=h[w],d=e(u).data("id"),f=i(p.sliceSelector,u),g=c.contains(["uk","us","au"],r.page.pageId)&&0===w,!f.length||g||y&&"closed"===y[d]||r.page.omitMPUs?w++:(v.push(f.first()),w+=b+1);return o.all(c(v).slice(0,s.length).map(function(t,c){var r=s[c],m=e(a(r,"container-inline")).addClass("ad-slot--mobile"),l=e(a(r,"container-inline")).addClass("ad-slot--not-mobile");return new o(function(e){n.write(function(){t.removeClass("fc-slice__item--no-mpu").append(l),m.insertAfter(i.ancestor(t[0],"fc-container")),e(null)})})}).valueOf()).then(function(){return v})};return{init:l}}),define("common/modules/commercial/third-party-tags/audience-science-gateway",["common/utils/config"],function(e){function n(){return e.switches.audienceScienceGateway?require(["js!//js.revsci.net/gateway/gw.js?csid=F09828&auto=t&bpid=theguardian"]):void 0}return{load:n}}),define("common/modules/commercial/third-party-tags/imr-worldwide",["common/utils/config"],function(e){function n(){if(e.switches.imrWorldwide){var n=new Image;return n.src=["//secure-uk.imrworldwide.com/cgi-bin/m?ci=uk-305078h&cg=0&cc=1&ts=compact","&si=",encodeURI(window.location.href),"&rp=",encodeURI(document.referrer),"&rnd=",(new Date).getTime()].join(""),n}}return{load:n}}),define("common/modules/commercial/third-party-tags/remarketing",["common/utils/config"],function(e){function n(){return e.switches.remarketing?require(["js!"+t],function(){window.google_trackConversion({google_conversion_id:971225648,google_custom_params:window.google_tag_params,google_remarketing_only:!0})}):void 0}var t="//www.googleadservices.com/pagead/conversion_async.js";return{load:n}}),define("text!common/views/commercial/outbrain.html",[],function(){return'<div class="OUTBRAIN <%=className%>" data-widget-id="<%=widgetCode%>" data-src="DROP_PERMALINK_HERE" data-ob-template="guardian"></div>'}),define("common/modules/commercial/third-party-tags/outbrain",["fastdom","common/utils/$","common/utils/_","common/utils/config","common/utils/detect","common/utils/mediator","common/utils/template","text!common/views/commercial/outbrain.html"],function(e,n,t,o,i,c,r,a){function m(){var c=n(".js-outbrain"),m=n(".js-outbrain-container");if(o.switches.outbrain&&!o.page.isPreview&&c.length>0){var l,d,f,g={},p={};if(g={mobile:"MB_2",tablet:"MB_1",desktop:"AR_11",wide:"AR_11"},l=g[i.getBreakpoint()],o.switches.newOutbrain){p={desktop:{image:{sections:"AR_12",all:"AR_13"},text:{sections:"AR_14",all:"AR_15"}},tablet:{image:{sections:"MB_6",all:"MB_7"},text:{sections:"MB_8",all:"MB_9"}},mobile:{image:{sections:"MB_4",all:"MB_5"}}};var h=i.getBreakpoint();h=t.contains(["wide","desktop"],h)?"desktop":h,d=p[h].image[s()],l=d}return e.write(function(){c.css("display","block"),m.append(n.create(r(a,{className:"outbrainImage",widgetCode:l})))}),o.switches.newOutbrain&&"mobile"!==h&&(f=p[h].text[s()],e.write(function(){m.append(n.create(r(a,{className:"outbrainText",widgetCode:f})))})),require(["js!"+u])}}function s(){return t.contains(["uk"],o.page.pageId.toLowerCase())||t.contains(["politics","world","business","commentisfree"],o.page.section.toLowerCase())?"sections":"all"}function l(){c.on("modules:commercial:dfp:rendered",function(e){"dfp-ad--merchandising-high"===e.slot.getSlotId().getDomId()&&e.isEmpty&&"childrens-books-site"!==o.page.section&&m()})}var u="//widgets.outbrain.com/outbrain.js";return{init:l,load:m}}),define("common/modules/commercial/third-party-tags",["Promise","common/utils/config","common/utils/mediator","common/modules/commercial/third-party-tags/audience-science-gateway","common/modules/commercial/third-party-tags/audience-science-pql","common/modules/commercial/third-party-tags/imr-worldwide","common/modules/commercial/third-party-tags/remarketing","common/modules/commercial/third-party-tags/krux","common/modules/commercial/third-party-tags/outbrain"],function(e,n,t,o,i,c,r,a,m){function s(){if("Identity"===n.page.contentType||"identity"===n.page.section)return!1;switch(n.page.edition.toLowerCase()){case"uk":i.load(),o.load()}return n.switches.thirdPartiesLater?t.once("modules:commercial:dfp:rendered",function(){l()}):l(),e.resolve(null)}function l(){c.load(),r.load(),n.switches.newOutbrain?m.init():m.load(),a.load()}return{init:s}}),define("bootstraps/commercial",["Promise","common/utils/config","common/utils/mediator","common/utils/robust","common/utils/_","common/modules/commercial/article-aside-adverts","common/modules/commercial/article-body-adverts","common/modules/commercial/badges","common/modules/commercial/dfp","common/modules/commercial/front-commercial-components","common/modules/commercial/slice-adverts","common/modules/commercial/third-party-tags","common/modules/user-prefs"],function(e,n,t,o,i,c,r,a,m,s,l,u,d){var f=[["cm-articleAsideAdverts",c.init],["cm-articleBodyAdverts",r.init],["cm-sliceAdverts",l.init],["cm-frontCommercialComponents",s.init],["cm-thirdPartyTags",u.init],["cm-badges",a.init]];return{init:function(){var c=[];d.isOff("adverts")||n.page.shouldHideAdverts||n.page.isSSL&&"admin"!==n.page.section||window.location.hash.match(/[#&]noads(&.*)?$/)||(i.forEach(f,function(e){o.catchErrorsAndLog(e[0],function(){c.push(e[1]())})}),e.all(c).then(function(){n.switches.commercial&&o.catchErrorsAndLogAll([["cm-dfp",m.init],["cm-ready",function(){t.emit("page:commercial:ready")}]])}))}}});
//# sourceMappingURL=commercial.js.map